# SongScribe â€“ Development Roadmap & Engineering Directives

*VersionÂ 0.1 â€“Â MayÂ 19Â 2025*

---

## 0Â â€¢Â Legend

| Tag       | Meaning                            |
| --------- | ---------------------------------- |
| **NOW**   | Sprintâ€‘blocking, start immediately |
| **NEXT**  | Start as soon as NOW items merge   |
| **LATER** | Niceâ€‘toâ€‘have / v1.x stretch        |
| **?**     | Decision required                  |

Each task lists *pointer files* and *Cursor IDE actions* so our coding assistant can jump straight to implementation.

---

## 1Â â€¢Â Schema & Rendering Refactor

| Priority | Task                                                                                                               | Pointer Files                                | Cursor Directives                                                                                                                                                 |
| -------- | ------------------------------------------------------------------------------------------------------------------ | -------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **NOW**  | **Introduce `ChordNode`** â€“ zeroâ€‘width inline, `atom: true`, attrs `{label, altShapes?, tuning?, capo?}`.          | `tiptap/ChordNode.ts` (NEW)<br>`schema.ts`   | 1. Add node spec.<br>2. Export in root schema.<br>3. Update starters.                                                                                             |
| **NOW**  | **Remove wordâ€‘grid & wordâ€‘index system**. Deprecate `WordDecorations` grid logic except optional lyric grid lines. | `tiptap/WordDecorations.ts`                  | 1. Strip index rebuild code.<br>2. Keep optional lyric grid toggle, gated behind `showGrid`.                                                                      |
| **NOW**  | **Create `ChordOverlayPlugin`** â€“ builds widget decorations positioned above first glyph of anchor word.           | `tiptap/plugins/ChordOverlayPlugin.ts` (NEW) | 1. Walk doc to find `ChordNode`s.<br>2. For each node, insert `Decoration.widget` with `side:-1`.<br>3. Use `view.domAtPos` + `clientRect()` to compute xâ€‘offset. |
| **NOW**  | **BarNode for instrumental beats** â€“ inline atom labelled `{bars: number}` representing `/` fillers.               | `tiptap/BarNode.ts` (NEW)                    | Implement parser + serializer to `/` lines and `{bars}` export.                                                                                                   |
| **NOW**  | **Legacy migration script** converting wordâ€‘index chords to new node model.                                        | `scripts/migrateChordPositions.ts` (NEW)     | Iterate paragraphs, insert chord node before target word, delete index field.                                                                                     |

---

## 2 â€¢ Editor UX / Controls

| Priority | Task                                                                                                      | Pointer Files                                    | Cursor Directives                                                 |
| -------- | --------------------------------------------------------------------------------------------------------- | ------------------------------------------------ | ----------------------------------------------------------------- |
| **NOW**  | **Toolbar Redesign v2** â€“ iconâ€‘only (lucide), 44â€¯px hitâ€‘area, Tailwind ghost buttons.                     | `components/toolbar/*`                           | Update JSX, remove label text, add `sr-only` labels.              |
| **NOW**  | **Tapâ€‘Tempo Button** â€“ metronome icon, captures last 4 taps âžœ sets `bpm` metadata, syncs with autoscroll. | `components/toolbar/TapTempo.tsx` (NEW)          | 1. Use `performance.now()` diff.<br>2. Dispatch `updateSong` bpm. |
| **NOW**  | **Mobile Back Button** (<640â€¯px).                                                                         | `layout/Header.tsx`                              | Show chevron, call `router.back()`.                               |
| **NEXT** | **Toolbar Record Button ðŸŽ™** â€“ add record icon to main toolbar; opens Recording Pane.                     | `components/toolbar/RecordButton.tsx` (NEW)      | Place icon beside TapTempo; triggers `RecordingPane.open()`.      |
| **NEXT** | **Capo Handling** â€“ metadata `capo`, autoâ€‘transpose display.                                              | `utils/transposition.ts`                         | Use tonal.js, show grey original on hover.                        |
| **NEXT** | **Alternate Tuning Support** â€“ metadata + chord picker filter.                                            | `services/chords.ts`                             | Add shape tables keyed by tuning.                                 |
| **NEXT** | **Chord Alternate Carousel** â€“ click chord âžœ bottom sheet of voicings.                                    | `components/ChordPicker.tsx`                     | Implement swipe / arrows navigation.                              |
| **NEXT** | **Section Spacing & Instrumental Slash Styling**.                                                         | `tiptap/plugins/SectionStyler.ts` (NEW)          | Collapse `/ / / /` lines, mute grey.                              |
| **NEXT** | **Settings Overhaul** â€“ UGâ€‘style groups *EditorÂ â€¢ PlaybackÂ â€¢ AppearanceÂ â€¢ Data*.                          | `components/SettingsPanel/*`                     | Figma reference attached.                                         |
| **NEXT** | **Theme System** â€“ Bear palettes JSON + live preview.                                                     | `theme/theme.ts`, `components/ThemeSwitcher.tsx` | Implement prefersâ€‘colorâ€‘scheme auto.                              |
| **NEXT** | **Folder Delete Behaviour** â€“ â€œDelete âžœ move songs to â€˜Unfiledâ€™ unless folder emptyâ€                      | `services/db.ts`, `components/Sidebar.tsx`       | Update Dexie transaction & UI prompts.                            |

## 3 â€¢ Audio & AI

| Priority  | Task                                                                                                                            | Pointer Files                      | Cursor Directives                                                                                          |
| --------- | ------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| **NEXT**  | **Audio Recording Module** â€“ offline mic capture, waveform, save to Dexie `recordings` store.                                   | `components/recorder/*` (NEW)      | Use MediaRecorder API, limit to 5Â min WAV; integrates with RecordingPane.                                  |
| **NEXT**  | **Recording Pane & Clip Manager** â€“ slide-up pane within song for managing recordings, waveforms, tags, Aâ€“B loop, clip mashups. | `components/RecordingPane/*` (NEW) | Implement bottom sheet via Radix; allow tagging sections, loop playback, clip cropping & sequence reorder. |
| **NEXT**  | **Autoâ€‘Parse Recording** (offline) â€“ key + bpm + chord map (TensorFlow\.js).                                                    | `services/audioAnalysis.ts` (NEW)  | Debounce; store results in recording metadata; feed clip display.                                          |
| **LATER** | Onâ€‘device lyric suggestion (ML).                                                                                                | â€”                                  | Placeholder.                                                                                               |

## 4 â€¢ Data & SyncÂ â€¢Â Data & Sync

| Priority  | Task                                                             | Pointer Files                     | Cursor Directives                                   |
| --------- | ---------------------------------------------------------------- | --------------------------------- | --------------------------------------------------- |
| **NOW**   | **Dexie Schema v1** â€“ songs, snapshots, recordings, settings.    | `services/db.ts`                  | Add `schemaVersion`, migration plan.                |
| **NEXT**  | **Export / Import**: JSON â‡„ ChordPro roundâ€‘trip helpers.         | `utils/chordpro.ts` (NEW)         | Serialize overlay chords to chord line; parse back. |
| **NEXT**  | **Snapshot / Versioning UI** â€“ linear history with diff preview. | `components/SnapshotTimeline.tsx` | Use ProseMirror steps CRDT later.                   |
| **LATER** | Cloud sync (CRDT)                                                | â€”                                 | TBD.                                                |

---

## 5Â â€¢Â Testing & Performance

1. **Unit tests**: chord node mapping, overlay positions at different font sizes.
2. **Cypress e2e**: insert/delete words, ensure chords donâ€™t drift.
3. **Perf budget**: <50â€¯ms toggle chord mode on 200â€‘line doc (MotoÂ G7).

---

## 6Â â€¢Â Mobile Features & PWA

| Priority | Deliverable                                                                 | Status       | Notes                                                                 |
| -------- | --------------------------------------------------------------------------- | ------------ | --------------------------------------------------------------------- |
| **DONE** | **Mobile Chord Builder** â€“ responsive chord creation with rotatable fretboard | âœ… Complete  | Touch-optimized interface with 90Â° rotation for portrait screens.     |
| **0**    | Audit PWA â€“ serviceâ€‘worker, offline install prompt.                         | ðŸš§ Pending  | Foundation for mobile app distribution.                               |
| **1**    | Capacitor shell (`cap add ios`).                                            | ðŸš§ Pending  | Native iOS wrapper for web app.                                      |
| **2**    | Native bridges for mic + FS.                                                | ðŸš§ Pending  | Access to device microphone and file system.                         |
| **3**    | Appâ€‘Store assets + privacy strings.                                         | ðŸš§ Pending  | Prepare for App Store submission.                                    |
| **4**    | Optional Swift bridge for CoreÂ ML chord detection if JS perf suffers.       | ðŸš§ Pending  | Enhanced chord recognition using device ML capabilities.              |

---

## 7Â â€¢Â Deferred / Stretch

* MIDI export after quantised note model lands.
* Realâ€‘time collaboration (WebRTC/CRDT).

---

### End of Roadmap 0.1

> **CTO note**: Merge *Schema Refactor* branch into `develop` before starting any NEXT items.
